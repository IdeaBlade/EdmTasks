<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- 
  	most of the csproj file is above here.  Put the following in place of the "AfterBuild" target in the .csproj file 
  -->

  <UsingTask TaskName="EdmTasks.EdmxWriteTask" AssemblyFile="C:\apps\whisper\development\Tools\EdmTasks\EdmTasks.dll" />
  <UsingTask TaskName="EdmTasks.ViewGenTask" AssemblyFile="C:\apps\whisper\development\Tools\EdmTasks\EdmTasks.dll" />

  <Target Name="AfterBuild" DependsOnTargets="DevForceEntityModelMetadataDeploy" Condition="'$(MetadataChanged)' == 'true'">

    <EdmxWriteTask Assembly="$(TargetPath)" DbContext="JonasNETDbContext" EdmxFile="JonasNETDbContext.edmx" />

    <ViewGenTask EdmxFile="JonasNETDbContext.edmx" Lang="cs" />

    <!-- Rebuild the project now so the user won't have to.  -->
    <MSBuild 
      Projects="$(MSBuildProjectFullPath)"
      Targets="CoreBuild"
      Properties="SkipDevForce=true;Rebuild=true" >
    </MSBuild>

  </Target>
</Project>